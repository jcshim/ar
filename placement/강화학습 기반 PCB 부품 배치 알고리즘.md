# **강화학습 기반 PCB 부품 배치 알고리즘** 
# **TD3, SAC, PPO** 같은 강화학습 알고리즘
# **그래프 기반 상태 인코딩**의 조합이 왜 효과적인가를 중점적으로

---

## ✅ 1. 문제 정의: PCB 부품 배치란?

PCB 부품 배치(Placement)는 다음을 만족해야 합니다:

- **연결된 부품끼리 가까워야** 배선이 짧아짐 (→ HPWL 최소화)
- **부품 간 겹침 없음**
- **전원 및 신호 간섭 최소화**
- **지정된 배치 영역 내에서 위치 결정**

이 문제는 **연속적 상태 및 행동 공간을 가지는 NP-완전 문제**입니다. 그래서 강화학습이 적합한 프레임워크로 여겨집니다.

---

## ✅ 2. 상태(State) 인코딩: **그래프 기반 인코딩**

### 📌 왜 그래프 인코딩이 필요한가?

- PCB 회로는 자연스럽게 **그래프 형태**  
  (부품: 노드 / 연결선(net): 엣지)
- 이 구조를 고려하지 않고 단순 이미지나 벡터로 표현하면 **연결 관계 정보 손실**

### 📌 구현 방식

- **노드(feature)**: 부품 유형, 핀 수, 전류 용량 등
- **엣지(feature)**: 연결된 net, 우선순위, 요구 전류 등
- **GNN(GCN, GAT)** 혹은 MLP 기반 인코더를 사용하여 **각 부품의 임베딩** 생성  
- 전체 배치 상태는 이 임베딩들의 집합으로 표현됨

이렇게 생성된 상태는 강화학습 정책에 입력됩니다.

---

## ✅ 3. 행동(Action): 부품 배치 위치 & 회전

- 각 부품에 대해:
  - **(x, y) 위치** 선택 (보통 격자 또는 연속 공간)
  - **회전 각도** 선택 (0, 90, 180, 270도 등)
- 연속 위치 선택이 필요한 경우 → **TD3, SAC**  
- 격자 기반 / 제한된 위치만 필요할 경우 → **PPO** 또는 DQN 계열

---

## ✅ 4. 보상(Reward)

보상 설계는 정책 학습의 핵심입니다. 보상 항목 예시는:

| 보상 항목 | 설명 |
|-----------|------|
| 📉 배선 길이(HPWL) 감소 | 모든 net의 total half-perimeter |
| 🚫 부품 간 겹침 페널티 | 배치 중 겹치는 경우 강한 패널티 |
| 📦 배치 면적 최적화 | 경계 초과 또는 공간 낭비 방지 |
| ⚡ 전력 루트 단축 | 전원/접지 핀 연결 길이 최소화 |
| 💡 타이밍 제약 반영 | 주요 net delay를 고려할 수도 있음 |

보상은 weighted sum 또는 normalized reward로 구성됩니다.

---

## ✅ 5. 정책 학습 알고리즘

### ✅ TD3 (Twin Delayed Deep Deterministic Policy Gradient)

- 연속 행동 공간에 적합
- **두 개의 Q-network** 사용 → Q값 과추정 방지
- 정책 네트워크 업데이트를 지연시켜 안정성 향상
- **위치 및 회전 angle을 연속적으로 출력** 가능

👉 복잡한 회로, 정밀한 배치에 유리

---

### ✅ SAC (Soft Actor-Critic)

- 최대 엔트로피 정책 → **탐험과 안정성의 균형**
- 학습 안정성이 높아 **배치 초기 탐색에 강함**
- 실제 회로 배치 실험에서 **TD3보다 더 우수한 일반화 성능**을 보인 사례도 있음

👉 다양한 회로에 공통 적용 가능한 **범용성 좋은 선택지**

---

### ✅ PPO (Proximal Policy Optimization)

- 신뢰영역 내에서 정책 업데이트 → 안정적 수렴
- 구현이 간단하고, 학습 속도 빠름
- 행동 공간이 **격자형**일 경우 매우 효과적

👉 **빠른 프로토타입 개발**에 유리하며, 정책 기반 RL의 대표주자

---

## ✅ 6. 대표 사례

| 논문/연구 | 특징 |
|-----------|------|
| **Luke Vassallo (2024)** | TD3 / SAC 적용, 적응형 보상 설계, SA 대비 21% 와이어 길이 감소 |
| **Yongxing Wang (2024)** | Graph 기반 상태 인코딩, DQN 기반 Q값 예측, EGA 대비 품질 우수 |
| **FanoutNet (2023)** | 배치 + Fanout 위치 결정, Attention 기반 신경망 사용 |
| **Google Circuit Training** | 칩 배치에 PPO 사용, 수백 개 macro 배치 자동화 |

---

## ✅ 정리: 최선의 PCB 부품 배치 방법

```txt
[그래프 기반 회로 인코딩] 
→ [GNN/MLP 임베딩] 
→ [강화학습 정책 (TD3 / SAC / PPO)] 
→ [부품별 위치 및 회전 결정] 
→ [배선 길이 & 충돌 기반 보상으로 정책 학습]
```

> 🔍 목표가 **정밀 배치 + 일반화**라면 → **SAC + 그래프 인코딩**  
> 🔍 목표가 **속도 + 단순 설계**라면 → **PPO + 격자 기반 상태**  
> 🔍 목표가 **지속 개선 가능한 구조**라면 → **TD3 + 경험 재사용**

---
