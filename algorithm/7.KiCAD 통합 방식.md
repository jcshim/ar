# KiCAD 통합 방식
### 강화학습 기반 PCB 자동 배치·배선 시스템을 **실제 설계 툴과 연동**시키는 데 필수적인 단계
### KiCAD는 **오픈소스이면서도 상용급 기능**을 제공하기 때문에 연구 및 프로토타입 구현에 널리 사용
### 통합 방식은 크게 **두 가지 흐름**으로 나눌 수 있음

---

## 🧩 1단계: **DSN / SES 파일 기반 I/O 방식** (초기 구현에 유리)

### ✅ 흐름 요약

```plaintext
KiCAD (PCBnew) → [DSN 파일] → RL 에이전트 → [SES 파일] → KiCAD
```

### ✅ 구성 요소

| 항목 | 설명 |
|------|------|
| **DSN (Design File)** | KiCAD에서 내보낸 회로 보드 + 넷리스트 정보 |
| **SES (Session File)** | 자동배선 결과 (트랙, via 위치 등) |
| **FreeRouting 형식 준수** | 대부분의 오픈소스 툴과 호환 가능

### ✅ 장점

- 구현 난이도 낮음 (파일만 주고받으면 됨)
- 기존 상용 라우터(FreeRouting 등)와 동일 방식 사용
- 초기 실험·성능 비교·디버깅에 매우 유리

---

## ⚙️ 2단계: **Python API 기반 실시간 제어** (인터랙티브 연동 가능)

### ✅ KiCAD Python API 주요 기능

- `pcbnew` 모듈을 통해 실시간으로 보드 제어 가능
- 트랙 추가, 비아 삽입, 부품 위치 이동 등을 Python으로 실행
- DRC(설계 규칙 검사)까지 API로 호출 가능

### ✅ 연동 예시

| 항목 | 설명 |
|------|------|
| `board = pcbnew.GetBoard()` | 현재 보드 객체 호출 |
| `track = pcbnew.TRACK(board)` | 트랙 객체 생성 |
| `track.SetStart(pt1); track.SetEnd(pt2)` | 배선 위치 설정 |
| `board.Add(track)` | 트랙 추가 완료 |

### ✅ 장점

- RL 에이전트의 **행동(action)**을 바로 보드에 반영 가능
- 배선 중간 상태도 **시각적 확인 및 DRC 체크** 가능
- 반복 실험 없이 **즉시 결과 반영 및 조정**

---

## 🧱 3단계: **KiCAD 플러그인화 (UI 통합)**

- Python API 기반 스크립트를 **KiCAD 플러그인**으로 등록
- 메뉴 버튼을 통해 “자동 배선 실행” 가능
- 사용자가 직접 보드 로딩 → 자동 배선 → 저장 가능

```python
class AutoRouterPlugin(pcbnew.ActionPlugin):
    def Run(self):
        run_my_rl_router()
```

- `*.kicad_pcb` 파일과 직접 통합 가능  
- GUI에 통합되므로 **상용 수준 데모 제공에 적합**

---

## 🔄 기타 통합 방식

| 방식 | 설명 | 특징 |
|------|------|------|
| CLI 연동 | KiCAD를 명령행으로 제어 (headless) | 서버형 아키텍처에 적합 |
| Web 연동 | KiCAD + Flask + RL API | 클라우드 테스트 환경 구축 가능 |
| KiKit 활용 | 자동화된 보드 생성 및 배포 | 대량 실험에 유용

---

## ✅ 단계별 요약 비교

| 방식 | 난이도 | 실시간성 | 장점 |
|------|--------|----------|------|
| DSN/SES 파일 I/O | 낮음 | ❌ (batch) | 빠른 구현, 기존 툴과 호환 |
| Python API | 중간 | ✅ | RL 액션 → 바로 보드 반영 |
| 플러그인화 | 높음 | ✅ | UI 통합, 상용화 준비 가능 |

---

초기 개발 단계에서는 **DSN/SES 방식으로 빠르게 성능 확인**,  
이후 고도화 단계에서는 **Python API를 통한 실시간 제어**나 **플러그인 통합**으로 확장하는 것이 효과적입니다.  
특히 Python API는 강화학습 모델의 행동을 실제 설계로 연결하는 핵심 브릿지 역할을 합니다.
