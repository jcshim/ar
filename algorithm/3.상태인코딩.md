# **PCB 자동 배치·배선 문제에서의 상태 인코딩**
## 에이전트가 현재 설계 상황을 얼마나 "정확히 이해"하느냐를 결정짓는 가장 핵심 요소 중 하나
##  **CNN + GNN 조합**은 공간적/구조적 정보 모두를 반영하는 가장 강력한 인코딩 방식

---

## 🧠 왜 상태 인코딩이 중요한가?

- 강화학습에서 상태(state)는 에이전트가 **의사결정을 내리는 유일한 단서**
- 잘 설계된 상태 표현은 **학습 속도**, **성능**, **일반화 능력**을 크게 향상시킴
- PCB 설계 문제는 **공간적인 배치**와 **회로 연결 구조(넷리스트)**라는 두 종류의 정보를 모두 포함

👉 그래서 CNN + GNN을 함께 사용하는 하이브리드 인코딩이 최선

---

## 🧩 CNN (Convolutional Neural Network) – **공간 인코딩 담당**

### ✔️ 역할
- PCB를 **2D 이미지처럼 처리**
- 격자(grid) 기반의 보드 레이아웃 상태를 CNN이 이해
- 부품 위치, 이미 배선된 트랙, 비아, 장애물 등의 **공간적 밀도와 패턴** 파악

### ✔️ 구현 방식

- 보드를 2D 격자(예: 156×156)로 표현
- 각 채널은 특정 정보 레이어를 담당:
  - `channel_1`: 부품 존재 여부  
  - `channel_2`: 현재 배선된 경로  
  - `channel_3`: 경로 충돌 위험  
  - `channel_4`: 전원핀 위치  
  - `channel_5`: 목표 핀 위치 등...

> 이 다채널 이미지를 CNN에 입력 → 공간적 특성 추출

---

## 🔗 GNN (Graph Neural Network) – **구조 인코딩 담당**

### ✔️ 역할
- 회로의 **논리적 연결 구조(Netlist)**를 그래프로 표현하고 이해
- 부품 간 신호 연결, 중요도, 연결 순서 등을 파악

### ✔️ 구성

- **노드(Node)**: 부품 또는 핀
- **엣지(Edge)**: Netlist 상의 연결 (signal, power, ground 등)
- 각 노드는 부품 특성(핀 수, 크기 등)을 feature로 가짐
- 각 엣지는 연결 유형, 거리, 전류량 등의 정보를 feature로 가짐

> 이 그래프를 **GCN, GAT, MPNN** 등으로 인코딩 → 노드 임베딩(128~512차원 벡터 등)

---

## 🔄 CNN + GNN 조합 방식

### 방식 1: **GNN + CNN 순차 조합**

1. GNN을 통해 각 부품(노드)에 대한 **고수준 임베딩** 생성
2. 이를 각 부품의 **위치에 매핑**하여 2D 격자에 삽입 (heatmap처럼)
3. CNN이 이 격자 전체를 다시 분석하여 **전반적 레이아웃 상태** 파악

---

### 방식 2: **멀티 스트림 병렬 처리**

- CNN 스트림: 현재 보드 상태 이미지 처리 (레이아웃, 배선 등)
- GNN 스트림: 회로 구조 인코딩 (논리 구조)
- 두 스트림의 출력 feature를 **병합(concatenate)** → policy/value 네트워크로 전달

```plaintext
[보드 격자 상태 이미지] → CNN → Feature A ┐
                                        ├─> 합성 → Policy / Value Network
[Netlist 그래프 구조]     → GNN → Feature B ┘
```

---

## 📊 왜 이 조합이 우수한가?

| 특성 | CNN만 사용 | GNN만 사용 | CNN + GNN 조합 |
|------|------------|------------|----------------|
| 공간 이해력 | ★★★★★ | ★★☆☆☆ | ★★★★★ |
| 회로 연결 이해 | ★☆☆☆☆ | ★★★★★ | ★★★★★ |
| 일반화 | ★★☆☆☆ | ★★★★☆ | ★★★★★ |
| 복잡 회로 대응 | ★★☆☆☆ | ★★★★☆ | ★★★★★ |
| 학습 효율 | 중 | 중~상 | 상 |

---

## 📌 적용 사례

| 논문 / 시스템 | 적용 방식 | 특징 |
|----------------|------------|-------|
| **FanoutNet** (2023) | CNN + Attention | Pin 위치 기반 fanout 결정 |
| **Yongxing Wang** (2024) | CNN + Graph 인코딩 | MLP 기반 구조 인코딩 + 공간 CNN |
| **AutoRoute-GNN** | GNN + PPO 조합 | 배선 탐색에 구조적 일반화 부여 |
| **Luke Vassallo** (2024) | 주변 환경 CNN + Netlist 구조 | 배선 경로 결정 시 CNN+구조 병합 |

---

## ✅ 결론: 상태 인코딩 Best Practice

```text
- 레이아웃 격자는 CNN으로 → 공간 정보
- Netlist는 GNN으로 → 회로 구조 정보
→ 병합 후 policy/value 네트워크로 전달
```

이 방식은 강화학습 에이전트에게 **"나는 지금 무엇을 어디에, 어떻게 연결해야 하는가?"** 를 직관적으로 알려주는 최고의 방식입니다.

---

원하시면 이걸 기반으로:
- 상태 인코딩 흐름도  
- 코드 구조 예시 (PyTorch / TensorFlow)  
- 각 방식별 성능 비교표  

도 만들어드릴게요. 필요하신가요? 😊
